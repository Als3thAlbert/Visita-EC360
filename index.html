<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Alta Visita – E-CONSULTING 360</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --naranja:#ff6600;
  --negro:#111;
  --gris:#555;
  --bg:#fafafa;
  --radius:8px;
  --fuente:15px/1.4 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);font:var(--fuente);color:var(--negro);padding:1rem;padding-bottom:80px}
header{margin-bottom:1rem;text-align:center}
.logo{font-size:1.6rem;font-weight:bold;color:var(--naranja);text-shadow:1px 1px 3px rgba(0,0,0,.25)}
form{display:grid;gap:.75rem}
label{font-weight:600;margin-bottom:-.5rem;display:block;color:var(--gris)}
input,textarea,select{width:100%;padding:.65rem;font-size:1rem;border:1px solid #ddd;border-radius:var(--radius);background:#fff}
textarea{resize:vertical;min-height:70px}
button{position:fixed;bottom:0;left:0;right:0;padding:1rem;font-size:1.1rem;font-weight:600;border:0;background:var(--naranja);color:#fff;cursor:pointer;box-shadow:0 -2px 8px rgba(0,0,0,.15);z-index:10}
button:active{opacity:.9}
#ticket{background:#fff;padding:1.2rem;border-radius:var(--radius);margin-top:1rem;box-shadow:0 2px 10px rgba(0,0,0,.08)}
#ticket .logo{font-size:1.4rem;font-weight:bold;color:var(--naranja);text-shadow:1px 1px 3px rgba(0,0,0,.25);margin-bottom:.6rem}
#ticket p{margin:.25rem 0}
.hidden{display:none}
.divider{height:1px;background:#ddd;margin:.6rem 0}
</style>
</head>
<body>

<header>
  <div class="logo">E-CONSULTING 360</div>
</header>

<form id="forma" autocomplete="off">
  <label>Nombre de empresa*</label>
  <input name="empresa" required>

  <label>Nombre cliente*</label>
  <input name="nombre" required>

  <label>Asesor*</label>
  <select name="asesor" required>
    <option value="">-- Selecciona --</option>
    <option>Jennifer Diana</option>
    <option>Marina</option>
    <option>Eli</option>
    <option>Iñigo</option>
    <option>Merche</option>
    <option>Núria</option>
    <option>Jenny AC</option>
    <option>Tere</option>
  </select>

  <label>Teléfono*</label>
  <input name="telefono" type="tel" required>

  <label>Dirección*</label>
  <input name="direccion" required>

  <label>Fecha/hora de la visita*</label>
  <input name="fecha_hora" type="datetime-local" required>

  <label>Fecha de la llamada*</label>
  <input name="fecha_llamada" type="date" required>

  <label>Observaciones</label>
  <textarea name="observ"></textarea>
</form>

<!-- PREVIEW -->
<div id="ticket" class="hidden">
  <div class="logo">E-CONSULTING 360</div>
  <p><strong>Empresa:</strong> <span id="pv_empresa"></span></p>
  <div class="divider"></div>
  <p><strong>Cliente:</strong> <span id="pv_nombre"></span></p>
  <p><strong>Asesor:</strong> <span id="pv_asesor"></span></p>
  <p><strong>Teléfono:</strong> <span id="pv_telefono"></span></p>
  <p><strong>Dirección:</strong> <span id="pv_direccion"></span></p>
  <div class="divider"></div>
  <p><strong>Fecha/hora visita:</strong> <span id="pv_fecha_visita"></span></p>
  <p><strong>Fecha llamada:</strong> <span id="pv_fecha_llamada"></span></p>
  <div class="divider"></div>
  <p><strong>Observ:</strong> <span id="pv_observ"></span></p>
</div>

<button type="submit" form="forma">Generar JPG y subir a Drive</button>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
document.querySelector('[name="fecha_llamada"]').valueAsDate=new Date();

forma.addEventListener('submit',async (e)=>{
  e.preventDefault();
  const d=Object.fromEntries(new FormData(forma));
  const fechaVisita=new Date(d.fecha_hora).toLocaleString('es-ES');
  const fechaLlamada=new Date(d.fecha_llamada).toLocaleDateString('es-ES');
  document.getElementById('pv_fecha_visita').textContent=fechaVisita;
  document.getElementById('pv_fecha_llamada').textContent=fechaLlamada;
  ['empresa','nombre','asesor','telefono','direccion','observ']
    .forEach(k=>{document.getElementById('pv_'+k).textContent=d[k]});
  ticket.classList.remove('hidden');

  const canvas=await html2canvas(ticket,{scale:3,backgroundColor:'#fff'});
  canvas.toBlob(async blob=>{
    const reader=new FileReader();
    reader.readAsDataURL(blob);
    reader.onloadend=async ()=>{
      const base64=reader.result.split(',')[1];
      // TU URL REAL DE WEBAPP
      const webApp='https://script.google.com/macros/s/AKfycbyXSH1HentT_0gysgH9haoyEzNdg8Pd7_TIno8UiN2ahjG77ugLq9EF-cXThYtlmUDsYQ/exec';
      const res=await fetch(webApp,{method:'POST',body:JSON.stringify({...d, jpg:base64})});
      const {url}=await res.json();
      if(navigator.share){await navigator.share({title:'Comprobante',url});}
      else{window.open(url,'_blank');}
    };
  });
});
</script>
</body>
</html>